# Repository Guidelines

## Project Structure & Module Organization
- `src/extension.ts`: main activation and logic.
- `src/test/*.test.ts`: unit/integration tests (compiled to `out/test`).
- `dist/extension.js`: build output (generated by `esbuild.js`).
- `.github/workflows/`: CI (`ci.yml`), release (`release.yml`), and release automation (`release-please.yml`).
- `CHANGELOG.md`: maintained automatically by Release Please.

## Build, Test, and Development Commands
- `npm run compile` — typecheck, lint, build dev bundle.
- `npm run package` — production build for releases.
- `npm test` — runs VS Code tests via `@vscode/test-cli` (CI uses `xvfb-run`).
- `npm run check` — typecheck + lint + tests.
- `npx @vscode/vsce package` — create a `.vsix` locally.

## Coding Style & Naming Conventions
- Language: TypeScript. Follow the repo’s ESLint rules (`eslint.config.mjs`).
- Indentation: 2 spaces; keep lines focused and readable.
- Prefer named exports; avoid default exports.
- Use explicit types where helpful; keep functions small and pure when possible.
- Run `npm run lint` before sending PRs; fix or justify any warnings.

## Testing Guidelines
- Runner: `@vscode/test-cli` (Mocha under the hood).
- Location: tests in `src/test`, filename pattern `*.test.ts`.
- Unit tests: isolate helpers (e.g., `getCommentSyntax`).
- Integration tests: spin up a VS Code instance and assert behavior on save.
- Run locally with `npm test`. CI runs headless under Xvfb.

## Packaging Notes
- The VSIX is kept minimal via `.vscodeignore` (excludes `.github/`, tests, TypeScript sources, Release Please files).
- Included: `dist/extension.js`, `package.json`, `README.md`, `CHANGELOG.md`, `LICENSE`.

## Commit & Pull Request Guidelines
- Conventional Commits are required (Release Please uses them):
  - `feat: …` (minor), `fix: …` (patch), `BREAKING CHANGE:` in body (major), others (`docs:`, `chore:`, `refactor:`) do not trigger releases by default.
  - To force a version, include `release-as: x.y.z` in the commit or PR body of the release PR.
- PRs should include: summary, linked issues (`Fixes #123`), passing CI.
- Commitlint enforces messages on PRs (skips Dependabot); see `.commitlintrc.cjs`. Local template: `git config commit.template .github/COMMIT_TEMPLATE.md`.

### Dependabot & Releases
- Dependabot PRs for npm are titled `fix(deps): bump ...` so they count as PATCH releases.
- Security updates are included in the same flow; merging them will trigger a patch release via Release Please.

## Releases & Publishing
- Flow:
  - Work with Conventional Commits → Release Please opens a release PR (updates version + CHANGELOG).
  - Merge the release PR → tag `vX.Y.Z` is created automatically.
  - Tag triggers `release.yml` → build VSIX, attach to GitHub Release, publish to Marketplace (needs `VSCE_PAT`).
- Manual fallback: `npm version x.y.z && git push --follow-tags` (bypasses Release Please).

## Security & Configuration Tips
- Never commit tokens. Add Marketplace token as `VSCE_PAT` (Repo → Settings → Secrets → Actions).
- `publisher` in `package.json` must match your Marketplace publisher.

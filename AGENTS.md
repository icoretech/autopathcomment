# Repository Guidelines

## Project Structure & Module Organization
- `src/extension.ts`: main activation and logic.
- `src/test/*.test.ts`: unit/integration tests (compiled to `out/test`).
- `dist/extension.js`: build output (generated by `esbuild.js`).
- `.github/workflows/`: CI (`ci.yml`), release (`release.yml`), and release automation (`release-please.yml`).
- `CHANGELOG.md`: maintained automatically by Release Please.

## Build, Test, and Development Commands
- `npm run compile` — typecheck, lint, and build development bundle.
- `npm run package` — production build used for releases.
- `npm test` — runs VS Code extension tests via `@vscode/test-cli`.
- `npm run check` — typecheck + lint + tests.
- `npx @vscode/vsce package` — create a `.vsix` locally.

## Coding Style & Naming Conventions
- Language: TypeScript. Follow the repo’s ESLint rules (`eslint.config.mjs`).
- Indentation: 2 spaces; keep lines focused and readable.
- Prefer named exports; avoid default exports.
- Use explicit types where helpful; keep functions small and pure when possible.
- Run `npm run lint` before sending PRs; fix or justify any warnings.

## Testing Guidelines
- Runner: `@vscode/test-cli` (Mocha under the hood).
- Location: tests in `src/test`, filename pattern `*.test.ts`.
- Unit tests: isolate helpers (e.g., `getCommentSyntax`).
- Integration tests: spin up a VS Code instance and assert behavior on save.
- Run locally with `npm test`. CI executes tests on PRs.

## Commit & Pull Request Guidelines
- Conventional Commits are required (used by Release Please):
  - `feat: add …`, `fix: correct …`, `docs: …`, `chore: …`, `refactor: …`.
- PRs should include: clear summary, linked issues (`Fixes #123`), and evidence of tests passing.
- Keep changes focused; avoid opportunistic refactors unless agreed.

## Releases & Publishing
- Release Please opens a release PR with version bump and CHANGELOG updates.
- Merging that PR creates a tag and GitHub Release.
- `release.yml` builds, attaches the `.vsix`, and publishes to Marketplace when `VSCE_PAT` is set as a repository secret.
- Manual alternative: `npm version x.y.z && git push --follow-tags` (must match `package.json`).

## Security & Configuration Tips
- Never commit tokens. Add Marketplace token as `VSCE_PAT` (Repo → Settings → Secrets → Actions).
- `publisher` in `package.json` must match your Marketplace publisher.
